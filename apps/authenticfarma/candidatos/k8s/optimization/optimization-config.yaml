apiVersion: v1
kind: ConfigMap
metadata:
  name: candidatos-optimization-script
  namespace: authenticfarma-prod
data:
  optimize.sh: |
    #!/bin/bash
    echo "ğŸš€ Iniciando optimizaciÃ³n segura..."
    
    cd /var/www/html
    
    # Verificar que estamos en el directorio correcto
    if [ ! -f "artisan" ]; then
        echo "âŒ No se encuentra artisan - abortando"
        exit 1
    fi
    
    # Crear backup
    echo "ğŸ’¾ Creando backup..."
    mkdir -p /tmp/backup
    cp -r bootstrap/cache /tmp/backup/ 2>/dev/null || echo "No hay cache para respaldar"
    
    # Aplicar optimizaciones seguras
    echo "âš¡ Aplicando optimizaciones..."
    
    # Limpiar caches (seguro)
    php artisan view:clear
    echo "âœ… Cache de vistas limpiado"
    
    # Crear nuevos caches (seguro)
    php artisan route:cache
    echo "âœ… Cache de rutas creado"
    
    php artisan view:cache  
    echo "âœ… Cache de vistas creado"
    
    # Verificar que funcionÃ³
    if php artisan route:list >/dev/null 2>&1; then
        echo "âœ… VerificaciÃ³n exitosa - optimizaciÃ³n completada"
        echo "ğŸ“Š Timestamp: $(date)"
    else
        echo "âŒ Error en verificaciÃ³n - restaurando backup"
        php artisan route:clear
        php artisan view:clear
        exit 1
    fi
    
  rollback.sh: |
    #!/bin/bash
    echo "ğŸ”„ Iniciando rollback de optimizaciÃ³n..."
    
    cd /var/www/html
    
    # Limpiar caches
    php artisan route:clear
    php artisan view:clear
    
    echo "âœ… Rollback completado"
