<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YoSoy Historia Cl√≠nica - Sistema M√©dico Digital</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            margin: 0;
            padding: 0;
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="loading" class="flex items-center justify-center min-h-screen bg-purple-50">
        <div class="text-center">
            <div class="loading-spinner w-16 h-16 border-4 border-purple-200 border-t-purple-600 rounded-full mx-auto mb-4"></div>
            <h1 class="text-2xl font-bold text-purple-900">YoSoy Historia Cl√≠nica</h1>
            <p class="text-purple-600 mt-2">Inicializando sistema m√©dico digital...</p>
            <p id="loading-status" class="text-sm text-purple-500 mt-1">Verificando dependencias...</p>
        </div>
    </div>

    <div id="app" style="display: none;"></div>

    <div id="error" style="display: none;" class="flex items-center justify-center min-h-screen bg-red-50">
        <div class="text-center max-w-md mx-auto p-6">
            <h1 class="text-2xl font-bold text-red-600 mb-4">Error al cargar la aplicaci√≥n</h1>
            <p id="error-message" class="text-red-500 mb-4"></p>
            <button onclick="location.reload()" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">
                Reintentar
            </button>
            <div class="mt-4">
                <a href="simple-app.html" class="text-blue-600 hover:text-blue-800 underline">
                    Usar versi√≥n simplificada
                </a>
            </div>
        </div>
    </div>

    <script>
        // Funci√≥n para mostrar estados
        function showLoading(message) {
            document.getElementById('loading-status').textContent = message;
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('app').style.display = 'none';
            document.getElementById('error').style.display = 'none';
        }

        function showApp() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            document.getElementById('error').style.display = 'none';
        }

        function showError(message) {
            document.getElementById('error-message').textContent = message;
            document.getElementById('loading').style.display = 'none';
            document.getElementById('app').style.display = 'none';
            document.getElementById('error').style.display = 'flex';
        }

        // Verificar dependencias
        function checkDependencies() {
            showLoading('Verificando React...');
            
            if (typeof React === 'undefined') {
                throw new Error('React no est√° disponible');
            }
            
            if (typeof ReactDOM === 'undefined') {
                throw new Error('ReactDOM no est√° disponible');
            }
            
            if (typeof Babel === 'undefined') {
                throw new Error('Babel no est√° disponible');
            }
            
            return true;
        }

        // Funci√≥n principal de inicializaci√≥n
        async function initializeApp() {
            try {
                showLoading('Verificando dependencias...');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                checkDependencies();
                
                showLoading('Compilando componentes...');
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // Aqu√≠ cargar√≠amos los componentes React
                loadReactComponents();
                
            } catch (error) {
                console.error('Error inicializando aplicaci√≥n:', error);
                showError(error.message);
            }
        }

        function loadReactComponents() {
            showLoading('Cargando aplicaci√≥n...');
            
            // C√≥digo React compilado directamente (sin JSX por ahora)
            const { useState, useEffect } = React;
            const { createRoot } = ReactDOM;

            function MedicalApp() {
                const [isAuthenticated, setIsAuthenticated] = useState(false);
                const [user, setUser] = useState(null);
                const [currentView, setCurrentView] = useState('login');

                const LoginForm = () => {
                    const [credentials, setCredentials] = useState({ username: '', password: '' });

                    const handleLogin = async (e) => {
                        e.preventDefault();
                        try {
                            const response = await fetch('http://localhost:3001/api/auth/login', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify(credentials)
                            });

                            if (response.ok) {
                                const data = await response.json();
                                setUser(data.user);
                                setIsAuthenticated(true);
                                setCurrentView('dashboard');
                            } else {
                                alert('Credenciales incorrectas');
                            }
                        } catch (error) {
                            console.error('Error de login:', error);
                            alert('Error de conexi√≥n con el servidor');
                        }
                    };

                    return React.createElement('div', {
                        className: 'min-h-screen bg-gradient-to-br from-purple-900 to-purple-700 flex items-center justify-center'
                    }, [
                        React.createElement('div', {
                            key: 'login-card',
                            className: 'bg-white rounded-lg shadow-xl p-8 w-full max-w-md'
                        }, [
                            React.createElement('h1', {
                                key: 'title',
                                className: 'text-3xl font-bold text-purple-900 text-center mb-8'
                            }, 'üè• YoSoy Historia Cl√≠nica'),
                            React.createElement('form', {
                                key: 'form',
                                onSubmit: handleLogin,
                                className: 'space-y-6'
                            }, [
                                React.createElement('div', { key: 'username-div' }, [
                                    React.createElement('label', {
                                        key: 'username-label',
                                        className: 'block text-sm font-medium text-gray-700 mb-2'
                                    }, 'Usuario'),
                                    React.createElement('input', {
                                        key: 'username-input',
                                        type: 'text',
                                        value: credentials.username,
                                        onChange: (e) => setCredentials({...credentials, username: e.target.value}),
                                        className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500',
                                        placeholder: 'Ingrese su usuario'
                                    })
                                ]),
                                React.createElement('div', { key: 'password-div' }, [
                                    React.createElement('label', {
                                        key: 'password-label',
                                        className: 'block text-sm font-medium text-gray-700 mb-2'
                                    }, 'Contrase√±a'),
                                    React.createElement('input', {
                                        key: 'password-input',
                                        type: 'password',
                                        value: credentials.password,
                                        onChange: (e) => setCredentials({...credentials, password: e.target.value}),
                                        className: 'w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500',
                                        placeholder: 'Ingrese su contrase√±a'
                                    })
                                ]),
                                React.createElement('button', {
                                    key: 'submit-button',
                                    type: 'submit',
                                    className: 'w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors'
                                }, 'Iniciar Sesi√≥n'),
                                React.createElement('div', {
                                    key: 'demo-info',
                                    className: 'text-center text-sm text-gray-500 mt-4 p-3 bg-gray-50 rounded'
                                }, [
                                    React.createElement('p', { key: 'demo-title', className: 'font-medium' }, 'Usuarios de demo:'),
                                    React.createElement('p', { key: 'admin' }, 'admin / admin123'),
                                    React.createElement('p', { key: 'medico' }, 'carlos / medico123')
                                ])
                            ])
                        ])
                    ]);
                };

                const Dashboard = () => {
                    return React.createElement('div', {
                        className: 'min-h-screen bg-gray-100'
                    }, [
                        React.createElement('div', {
                            key: 'header',
                            className: 'bg-purple-900 text-white p-4'
                        }, [
                            React.createElement('div', {
                                key: 'header-content',
                                className: 'container mx-auto flex justify-between items-center'
                            }, [
                                React.createElement('h1', {
                                    key: 'header-title',
                                    className: 'text-2xl font-bold'
                                }, 'üè• YoSoy Historia Cl√≠nica'),
                                React.createElement('div', {
                                    key: 'user-info',
                                    className: 'flex items-center space-x-4'
                                }, [
                                    React.createElement('span', { key: 'welcome' }, `Bienvenido, ${user?.nombre || 'Usuario'}`),
                                    React.createElement('button', {
                                        key: 'logout',
                                        onClick: () => {
                                            setIsAuthenticated(false);
                                            setUser(null);
                                            setCurrentView('login');
                                        },
                                        className: 'bg-purple-700 hover:bg-purple-600 px-4 py-2 rounded'
                                    }, 'Cerrar Sesi√≥n')
                                ])
                            ])
                        ]),
                        React.createElement('div', {
                            key: 'main-content',
                            className: 'container mx-auto p-6'
                        }, [
                            React.createElement('div', {
                                key: 'cards-grid',
                                className: 'grid grid-cols-1 md:grid-cols-3 gap-6'
                            }, [
                                React.createElement('div', {
                                    key: 'patients-card',
                                    className: 'bg-white rounded-lg shadow-lg p-6'
                                }, [
                                    React.createElement('h2', {
                                        key: 'patients-title',
                                        className: 'text-xl font-semibold text-purple-900 mb-4'
                                    }, 'üë• Pacientes'),
                                    React.createElement('p', {
                                        key: 'patients-desc',
                                        className: 'text-gray-600 mb-4'
                                    }, 'Gesti√≥n de informaci√≥n de pacientes'),
                                    React.createElement('button', {
                                        key: 'patients-btn',
                                        className: 'bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700'
                                    }, 'Ver Pacientes')
                                ]),
                                React.createElement('div', {
                                    key: 'records-card',
                                    className: 'bg-white rounded-lg shadow-lg p-6'
                                }, [
                                    React.createElement('h2', {
                                        key: 'records-title',
                                        className: 'text-xl font-semibold text-purple-900 mb-4'
                                    }, 'üìã Historias Cl√≠nicas'),
                                    React.createElement('p', {
                                        key: 'records-desc',
                                        className: 'text-gray-600 mb-4'
                                    }, 'Registro m√©dico digital'),
                                    React.createElement('button', {
                                        key: 'records-btn',
                                        className: 'bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700'
                                    }, 'Nueva Historia')
                                ]),
                                React.createElement('div', {
                                    key: 'notifications-card',
                                    className: 'bg-white rounded-lg shadow-lg p-6'
                                }, [
                                    React.createElement('h2', {
                                        key: 'notifications-title',
                                        className: 'text-xl font-semibold text-purple-900 mb-4'
                                    }, 'üîî Notificaciones'),
                                    React.createElement('p', {
                                        key: 'notifications-desc',
                                        className: 'text-gray-600 mb-4'
                                    }, 'Alertas y recordatorios'),
                                    React.createElement('button', {
                                        key: 'notifications-btn',
                                        onClick: () => window.open('demo-notificaciones.html', '_blank'),
                                        className: 'bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700'
                                    }, 'Ver Notificaciones')
                                ])
                            ]),
                            React.createElement('div', {
                                key: 'app-links',
                                className: 'mt-8 bg-white rounded-lg shadow-lg p-6'
                            }, [
                                React.createElement('h3', {
                                    key: 'links-title',
                                    className: 'text-lg font-semibold mb-4'
                                }, 'Aplicaciones del Sistema'),
                                React.createElement('div', {
                                    key: 'links-grid',
                                    className: 'grid grid-cols-1 md:grid-cols-2 gap-4'
                                }, [
                                    React.createElement('a', {
                                        key: 'full-app-link',
                                        href: 'secure-medical-system.html',
                                        className: 'block bg-green-600 text-white p-4 rounded hover:bg-green-700 text-center'
                                    }, 'üöÄ Aplicaci√≥n Completa'),
                                    React.createElement('a', {
                                        key: 'diagnostics-link',
                                        href: 'diagnostico.html',
                                        className: 'block bg-blue-600 text-white p-4 rounded hover:bg-blue-700 text-center'
                                    }, 'üîç Diagn√≥stico del Sistema')
                                ])
                            ])
                        ])
                    ]);
                };

                if (!isAuthenticated) {
                    return React.createElement(LoginForm);
                }

                return React.createElement(Dashboard);
            }

            try {
                const root = createRoot(document.getElementById('app'));
                root.render(React.createElement(MedicalApp));
                showApp();
                console.log('‚úÖ Aplicaci√≥n React cargada correctamente');
            } catch (error) {
                console.error('Error renderizando React:', error);
                showError('Error al renderizar la aplicaci√≥n: ' + error.message);
            }
        }

        // Iniciar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM cargado, inicializando aplicaci√≥n...');
            setTimeout(initializeApp, 100);
        });

        // Fallback si DOMContentLoaded ya se ejecut√≥
        if (document.readyState === 'loading') {
            // Ya est√° configurado el listener
        } else {
            setTimeout(initializeApp, 100);
        }
    </script>
</body>
</html>